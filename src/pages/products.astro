---
import Layout from '~/layouts/PageLayout.astro';
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';

// Import images
import industrialStorageTanks from '~/assets/images/Industrial Storage Tanks.jpg';
import mtnMudTruck from '~/assets/images/MTN Mud Truck.jpg';

const metadata = {
  title: 'Products - Premium Drilling Fluids & Additives | MTN Mud',
  description:
    'Premium products for every drilling challenge. Over 1 million pounds of bulk barite and 20,000+ barrels of OBM in stock.',
};

// Get all products from the collection
const allProducts = await getCollection('products');

// Group products by category and sort by order
const productsByCategory = allProducts.reduce(
  (acc, product) => {
    const category = product.data.category;
    if (!acc[category]) {
      acc[category] = [];
    }
    acc[category].push(product);
    return acc;
  },
  {} as Record<string, typeof allProducts>
);

// Sort products within each category by order
Object.keys(productsByCategory).forEach((category) => {
  productsByCategory[category].sort((a, b) => a.data.order - b.data.order);
});

// Get category names sorted alphabetically
const categories = Object.keys(productsByCategory).sort();
---

<Layout metadata={metadata}>
  <!-- SECTION 1: HERO -->
  <section class="relative bg-charcoal-900 overflow-hidden min-h-[600px] md:min-h-[700px]">
    <!-- Background Image -->
    <div
      class="absolute inset-0 bg-cover bg-center bg-no-repeat opacity-60"
      style={`background-image: url('${industrialStorageTanks.src}');`}
    >
    </div>
    <!-- Gradient Overlay -->
    <div class="absolute inset-0 bg-gradient-to-r from-charcoal-900/90 via-charcoal-900/70 to-transparent"></div>

    <div class="container mx-auto px-10 py-32 md:py-48 max-w-7xl relative z-10">
      <div class="max-w-3xl">
        <div
          class="inline-block bg-safety-orange/10 text-safety-orange px-4 py-2 rounded-lg text-xs font-black mb-6 uppercase tracking-wider"
        >
          Always in Stock. Always Ready.
        </div>
        <h1 class="text-5xl md:text-6xl lg:text-7xl font-black mb-8 text-white leading-tight tracking-tight">
          Premium Products for Every Drilling Challenge
        </h1>
        <p class="text-xl md:text-2xl text-warm-gray-200 leading-relaxed mb-10">
          From standard drilling mud additives to specialty products for unique geological formations, MTN Mud
          delivers the quality and consistency your operations demand.
        </p>
        <div class="flex flex-col sm:flex-row gap-4">
          <a class="btn style2" href="#products">View Product Catalog <i class="ri-arrow-right-up-line"></i></a>
          <a class="btn style6" href="tel:307-682-8688">Call 307-682-8688 <i class="ri-arrow-right-up-line"></i></a>
        </div>
      </div>
    </div>
  </section>

  <!-- SECTION 2: INVENTORY STATS -->
  <section class="bg-warm-white">
    <div class="container mx-auto max-w-6xl p-10">
      <div class="text-center mb-12">
        <div
          class="inline-block bg-safety-orange/10 text-safety-orange px-4 py-2 rounded-lg text-xs font-black mb-4 uppercase tracking-wider"
        >
          Industry-Leading Inventory
        </div>
        <h2 class="text-4xl md:text-5xl font-black mb-6 text-charcoal-900">Always Ready to Deliver</h2>
        <p class="text-lg text-charcoal-700 leading-relaxed max-w-3xl mx-auto">
          With massive inventory levels across all product categories, we have what you need when you need it—no
          back-orders, no delays.
        </p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="text-center bg-charcoal-800 p-8 rounded-2xl shadow-soft-lg border-t-4 border-safety-orange">
          <div class="text-5xl font-black text-safety-orange mb-3 font-mono">1M+</div>
          <div class="text-sm font-bold text-warm-gray-200 uppercase tracking-wider">Pounds of Bulk Barite</div>
        </div>
        <div class="text-center bg-charcoal-800 p-8 rounded-2xl shadow-soft-lg border-t-4 border-safety-orange">
          <div class="text-5xl font-black text-safety-orange mb-3 font-mono">20K+</div>
          <div class="text-sm font-bold text-warm-gray-200 uppercase tracking-wider">Barrels of OBM in Stock</div>
        </div>
        <div class="text-center bg-charcoal-800 p-8 rounded-2xl shadow-soft-lg border-t-4 border-safety-orange">
          <div class="text-5xl font-black text-safety-orange mb-3 font-mono">24/7</div>
          <div class="text-sm font-bold text-warm-gray-200 uppercase tracking-wider">Product Availability</div>
        </div>
      </div>
    </div>
  </section>

  <!-- SECTION 3: PRODUCTS WITH TABS -->
  <section id="products" class="bg-charcoal-900 py-20 md:py-28">
    <div class="container mx-auto max-w-7xl p-10">
      <div class="text-center mb-12">
        <div
          class="inline-block bg-safety-orange/10 text-safety-orange px-4 py-2 rounded-lg text-xs font-black mb-4 uppercase tracking-wider"
        >
          Complete Catalog
        </div>
        <h2 class="text-3xl md:text-4xl font-black mb-6 text-white tracking-tight">Our Products</h2>
        <p class="text-lg text-warm-gray-200 max-w-3xl mx-auto font-medium mb-8">
          Browse our complete catalog organized by category. All products are in stock and ready for immediate delivery.
        </p>
      </div>

      <!-- Tab Navigation -->
      <div class="mb-8 flex items-center gap-4">
        <!-- Left Arrow -->
        <button
          id="scroll-left"
          class="hidden lg:flex flex-shrink-0 bg-safety-orange text-white p-3 rounded-full shadow-lg hover:bg-safety-orange-600 transition-all items-center justify-center"
          aria-label="Scroll left"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7"></path>
          </svg>
        </button>

        <!-- Tabs Container -->
        <div id="tabs-container" class="overflow-x-auto scrollbar-hide scroll-smooth flex-1">
          <div class="flex gap-2 min-w-max md:flex-wrap md:justify-center">
            {
              categories.map((category, index) => (
                <button
                  class:list={[
                    'tab-button px-6 py-3 font-bold text-sm uppercase tracking-wide rounded-lg transition-all whitespace-nowrap',
                    index === 0
                      ? 'bg-safety-orange text-white'
                      : 'bg-charcoal-800 text-white hover:bg-safety-orange/20',
                  ]}
                  data-tab={category}
                >
                  {category}
                </button>
              ))
            }
          </div>
        </div>

        <!-- Right Arrow -->
        <button
          id="scroll-right"
          class="hidden lg:flex flex-shrink-0 bg-safety-orange text-white p-3 rounded-full shadow-lg hover:bg-safety-orange-600 transition-all items-center justify-center"
          aria-label="Scroll right"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"></path>
          </svg>
        </button>
      </div>

      <!-- Tab Content -->
      {
        categories.map((category, index) => (
          <div class:list={['tab-content', index !== 0 && 'hidden']} data-content={category}>
            <div class="bg-charcoal-900 rounded-2xl shadow-soft-lg border-4 border-charcoal-800 overflow-hidden">
              <div class="overflow-x-auto">
                <table class="w-full">
                  <thead class="bg-charcoal-900 border-b-4 border-safety-orange">
                    <tr>
                      <th class="px-6 py-4 text-left font-black text-white uppercase tracking-wider text-sm">
                        Product Name
                      </th>
                      <th class="px-6 py-4 text-left font-black text-white uppercase tracking-wider text-sm">Size</th>
                      <th class="px-6 py-4 text-left font-black text-white uppercase tracking-wider text-sm">
                        Data Sheet
                      </th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-charcoal-700">
                    {productsByCategory[category].map((product, idx) => (
                      <tr class={idx % 2 === 0 ? 'bg-charcoal-800' : 'bg-charcoal-700'}>
                        <td class="px-6 py-4 font-bold text-white">{product.data.title}</td>
                        <td class="px-6 py-4 text-warm-gray-200 font-medium">{product.data.size || '-'}</td>
                        <td class="px-6 py-4">
                          {product.data.datasheet ? (
                            <a
                              href={product.data.datasheet}
                              class="text-safety-orange hover:text-safety-orange-700 font-bold inline-flex items-center gap-2 hover:underline transition-all"
                              target="_blank"
                              rel="noopener noreferrer"
                            >
                              <svg
                                class="w-5 h-5"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg"
                              >
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  stroke-width="2.5"
                                  d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                                />
                              </svg>
                              <span class="text-sm">PDF</span>
                            </a>
                          ) : (
                            <span class="text-charcoal-400 text-sm">-</span>
                          )}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        ))
      }

      <div class="mt-10 bg-charcoal-800 border-l-4 border-safety-orange p-8 rounded-xl shadow-soft">
        <p class="text-warm-gray-200 leading-relaxed font-medium">
          <strong class="text-white">Need pricing or additional information?</strong> Contact our team for current
          pricing, technical specifications, and availability. We can also special order any product not listed here.
        </p>
      </div>
    </div>
  </section>

  <!-- SECTION 4: DELIVERY & LOGISTICS -->
  <section class="bg-warm-white">
    <div class="container mx-auto max-w-6xl p-10">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16 items-center">
        <!-- Left: Image -->
        <div>
          <Image
            src={mtnMudTruck}
            alt="MTN Mud delivery truck"
            class="w-full h-full min-h-96 rounded-2xl shadow-soft-lg object-cover"
          />
        </div>

        <!-- Right: Content -->
        <div>
          <div
            class="inline-block bg-safety-orange/10 text-safety-orange px-4 py-2 rounded-lg text-xs font-black mb-4 uppercase tracking-wider"
          >
            Logistics & Delivery
          </div>
          <h2 class="text-3xl md:text-4xl font-black mb-8 text-charcoal-900 tracking-tight">
            Fast, Reliable Product Delivery
          </h2>
          <p class="text-lg text-charcoal-600 leading-relaxed mb-6 font-medium">
            Having the right products in stock means nothing if we can't get them to your location on time. That's why
            we operate our own fleet of 65+ trailers and 15+ trucks—ensuring 24/7 delivery capability across the Rockies
            and beyond.
          </p>

          <ul class="space-y-4 text-charcoal-700 mb-8">
            <li class="flex items-start">
              <svg
                class="w-6 h-6 text-safety-orange mr-3 flex-shrink-0 mt-0.5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
              </svg>
              <span class="font-medium">24/7 delivery from Gillette, Cheyenne, and Williston</span>
            </li>
            <li class="flex items-start">
              <svg
                class="w-6 h-6 text-safety-orange mr-3 flex-shrink-0 mt-0.5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
              </svg>
              <span class="font-medium">Single pallets to bulk shipments—we handle it all</span>
            </li>
            <li class="flex items-start">
              <svg
                class="w-6 h-6 text-safety-orange mr-3 flex-shrink-0 mt-0.5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
              </svg>
              <span class="font-medium">No third-party logistics—direct from our facility to your rig</span>
            </li>
            <li class="flex items-start">
              <svg
                class="w-6 h-6 text-safety-orange mr-3 flex-shrink-0 mt-0.5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
              </svg>
              <span class="font-medium">Real-time order tracking and communication</span>
            </li>
          </ul>

          <a href="/contact" class="btn style2">
            Request Delivery Quote <i class="ri-arrow-right-up-line"></i>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- SECTION 5: CTA -->
  <section class="relative bg-charcoal-900 py-28 md:py-36 overflow-hidden">
    <div class="absolute inset-0">
      <Image
        src={industrialStorageTanks}
        alt="Industrial storage tanks"
        class="w-full h-full object-cover opacity-20"
      />
      <div class="absolute inset-0 bg-gradient-to-t from-charcoal-900 via-charcoal-900/80 to-charcoal-900/60"></div>
    </div>

    <div class="container mx-auto max-w-4xl text-center relative z-10 p-10">
      <h2 class="text-4xl md:text-5xl lg:text-6xl font-black mb-6 text-white leading-tight">
        Can't Find What You Need?
      </h2>
      <p class="text-xl md:text-2xl text-warm-gray-200 leading-relaxed mb-12 max-w-3xl mx-auto">
        Any item not listed can be special ordered at any time. Contact our team for availability, pricing, or custom
        formulations tailored to your specific drilling requirements.
      </p>

      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a class="btn style2" href="/contact">Contact Product Specialists <i class="ri-arrow-right-up-line"></i></a>
        <a class="btn style6" href="tel:307-682-8688">Call 307-682-8688 <i class="ri-arrow-right-up-line"></i></a>
      </div>
    </div>
  </section>
</Layout>

<script>
  // Tab switching functionality
  document.addEventListener('DOMContentLoaded', () => {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    const tabsContainer = document.getElementById('tabs-container');
    const scrollLeftBtn = document.getElementById('scroll-left');
    const scrollRightBtn = document.getElementById('scroll-right');

    // Tab switching
    tabButtons.forEach((button) => {
      button.addEventListener('click', () => {
        const targetTab = button.getAttribute('data-tab');

        // Remove active class from all buttons
        tabButtons.forEach((btn) => {
          btn.classList.remove('bg-safety-orange');
          btn.classList.add('bg-charcoal-800', 'text-white');
        });

        // Add active class to clicked button
        button.classList.remove('bg-charcoal-800');
        button.classList.add('bg-safety-orange', 'text-white');

        // Hide all tab contents
        tabContents.forEach((content) => {
          content.classList.add('hidden');
        });

        // Show target tab content
        const targetContent = document.querySelector(`[data-content="${targetTab}"]`);
        if (targetContent) {
          targetContent.classList.remove('hidden');
        }
      });
    });

    // Scroll functionality
    if (scrollLeftBtn && scrollRightBtn && tabsContainer) {
      scrollLeftBtn.addEventListener('click', () => {
        tabsContainer.scrollBy({ left: -300, behavior: 'smooth' });
      });

      scrollRightBtn.addEventListener('click', () => {
        tabsContainer.scrollBy({ left: 300, behavior: 'smooth' });
      });

      // Update arrow visibility based on scroll position
      const updateArrows = () => {
        const { scrollLeft, scrollWidth, clientWidth } = tabsContainer;

        // Hide left arrow if at start
        if (scrollLeft <= 0) {
          scrollLeftBtn.style.opacity = '0.3';
          scrollLeftBtn.style.pointerEvents = 'none';
        } else {
          scrollLeftBtn.style.opacity = '1';
          scrollLeftBtn.style.pointerEvents = 'auto';
        }

        // Hide right arrow if at end
        if (scrollLeft + clientWidth >= scrollWidth - 10) {
          scrollRightBtn.style.opacity = '0.3';
          scrollRightBtn.style.pointerEvents = 'none';
        } else {
          scrollRightBtn.style.opacity = '1';
          scrollRightBtn.style.pointerEvents = 'auto';
        }
      };

      tabsContainer.addEventListener('scroll', updateArrows);
      window.addEventListener('resize', updateArrows);
      updateArrows(); // Initial check
    }
  });
</script>

<style>
  /* Hide scrollbar for Chrome, Safari and Opera */
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* Hide scrollbar for IE, Edge and Firefox */
  .scrollbar-hide {
    -ms-overflow-style: none; /* IE and Edge */
    scrollbar-width: none; /* Firefox */
  }
</style>

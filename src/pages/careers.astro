---
// Careers page - fetches jobs from D1 database
export const prerender = false;

import Layout from '~/layouts/PageLayout.astro';

// Image imports
import constructionWorkerOnSite from '~/assets/images/new/Construction Workers On Site.webp';

const metadata = {
  title: 'Careers - Join the MTN MUD Team | MTN MUD',
  description:
    'Join MTN MUD and be part of a team that values safety, service excellence, and innovation. Competitive compensation and career growth opportunities.',
};

// Get runtime environment
const env = Astro.locals.runtime?.env;
const DB = env?.DB;

// Type for active jobs display
type ActiveJob = {
  id: string;
  title: string;
  locations: string;
  description: string | null;
};

let activeJobs: ActiveJob[] = [];

if (DB) {
  try {
    const result = await DB.prepare(
      `
      SELECT id, title, locations, description
      FROM jobs
      WHERE is_active = 1
      ORDER BY sort_order, title
    `
    ).all();

    activeJobs = (result.results || []) as ActiveJob[];
  } catch (error) {
    console.error('Jobs fetch error:', error);
  }
}
---

<Layout metadata={metadata}>
  <!-- SECTION 1: HERO -->
  <section class="relative bg-charcoal-900 overflow-hidden min-h-[600px] md:min-h-[700px]">
    <!-- Background Image -->
    <div
      class="absolute inset-0 bg-cover bg-center bg-no-repeat"
      style={`background-image: url('${constructionWorkerOnSite.src}');`}
    >
    </div>
    <!-- Dark Overlay -->
    <div class="absolute inset-0 bg-charcoal-900/50"></div>
    <!-- Gradient Overlay -->
    <div class="absolute inset-0 bg-gradient-to-b from-charcoal-900/80 via-charcoal-900/70 to-charcoal-900"></div>

    <div class="container mx-auto px-4 max-w-5xl py-28 md:py-40 text-center relative z-10">
      <div
        class="inline-block bg-safety-orange text-white px-4 py-2 rounded-lg text-xs font-black mb-6 uppercase tracking-wider shadow-lg"
      >
        Build Your Career
      </div>
      <h1 class="text-5xl md:text-6xl lg:text-7xl font-black mb-8 text-white leading-tight tracking-tight">
        Join the MTN MUD Team
      </h1>
      <p class="text-xl md:text-2xl text-warm-gray-200 leading-relaxed max-w-4xl mx-auto mb-8">
        We're always looking for talented professionals who share our commitment to service excellence, safety, and
        innovation. If you're passionate about the drilling fluids industry and want to be part of a team that values
        your expertise, your growth, and your family—we want to hear from you.
      </p>
      <p class="text-sm text-warm-gray-400 italic">
        Additional details including specific job requirements and benefits information to be provided
      </p>
    </div>
  </section>

  <!-- SECTION 2: WHY WORK HERE -->
  <section class="bg-warm-white p-10">
    <div class="container mx-auto max-w-7xl">
      <div class="text-center mb-16">
        <div
          class="inline-block bg-safety-orange/10 text-safety-orange px-4 py-2 rounded-lg text-xs font-black mb-4 uppercase tracking-wider"
        >
          Benefits & Culture
        </div>
        <h2 class="text-4xl md:text-5xl font-black mb-6 text-charcoal-900">Why Work at MTN MUD?</h2>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Card 1 -->
        <div class="bg-white p-8 rounded-2xl shadow-soft-lg hover:shadow-soft-xl transition-all group">
          <div
            class="w-14 h-14 bg-safety-orange/10 rounded-xl flex items-center justify-center mb-5 group-hover:bg-safety-orange transition-all"
          >
            <svg
              class="w-7 h-7 text-safety-orange group-hover:text-white transition-all"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
              ></path>
            </svg>
          </div>
          <h4 class="text-xl font-black mb-4 text-charcoal-900 uppercase tracking-tight">Safety-First Culture</h4>
          <p class="text-charcoal-700 leading-relaxed">
            We don't just talk about safety—we live it every day. Your well-being and that of your family is our top
            priority.
          </p>
        </div>

        <!-- Card 2 -->
        <div class="bg-white p-8 rounded-2xl shadow-soft-lg hover:shadow-soft-xl transition-all group">
          <div
            class="w-14 h-14 bg-safety-orange/10 rounded-xl flex items-center justify-center mb-5 group-hover:bg-safety-orange transition-all"
          >
            <svg
              class="w-7 h-7 text-safety-orange group-hover:text-white transition-all"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
              ></path>
            </svg>
          </div>
          <h4 class="text-xl font-black mb-4 text-charcoal-900 uppercase tracking-tight">Career Growth</h4>
          <p class="text-charcoal-700 leading-relaxed">
            We invest in our team members through training, mentorship, and opportunities for advancement. Your
            professional development is essential to our success.
          </p>
        </div>

        <!-- Card 3 -->
        <div class="bg-white p-8 rounded-2xl shadow-soft-lg hover:shadow-soft-xl transition-all group">
          <div
            class="w-14 h-14 bg-safety-orange/10 rounded-xl flex items-center justify-center mb-5 group-hover:bg-safety-orange transition-all"
          >
            <svg
              class="w-7 h-7 text-safety-orange group-hover:text-white transition-all"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
              ></path>
            </svg>
          </div>
          <h4 class="text-xl font-black mb-4 text-charcoal-900 uppercase tracking-tight">Work-Life Balance</h4>
          <p class="text-charcoal-700 leading-relaxed">
            We understand the importance of family. We strive to create schedules and opportunities that allow you to
            build a career while maintaining what matters most.
          </p>
        </div>

        <!-- Card 4 -->
        <div class="bg-white p-8 rounded-2xl shadow-soft-lg hover:shadow-soft-xl transition-all group">
          <div
            class="w-14 h-14 bg-safety-orange/10 rounded-xl flex items-center justify-center mb-5 group-hover:bg-safety-orange transition-all"
          >
            <svg
              class="w-7 h-7 text-safety-orange group-hover:text-white transition-all"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"
              ></path>
            </svg>
          </div>
          <h4 class="text-xl font-black mb-4 text-charcoal-900 uppercase tracking-tight">Industry-Leading Equipment</h4>
          <p class="text-charcoal-700 leading-relaxed">
            Work with the best tools in the business. From our mud labs to our private fleet, we provide the equipment
            and resources you need to excel.
          </p>
        </div>

        <!-- Card 5 -->
        <div class="bg-white p-8 rounded-2xl shadow-soft-lg hover:shadow-soft-xl transition-all group">
          <div
            class="w-14 h-14 bg-safety-orange/10 rounded-xl flex items-center justify-center mb-5 group-hover:bg-safety-orange transition-all"
          >
            <svg
              class="w-7 h-7 text-safety-orange group-hover:text-white transition-all"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path>
            </svg>
          </div>
          <h4 class="text-xl font-black mb-4 text-charcoal-900 uppercase tracking-tight">Competitive Compensation</h4>
          <p class="text-charcoal-700 leading-relaxed">
            We offer competitive pay and benefits packages that recognize your skills, experience, and the value you
            bring to our team.
          </p>
        </div>

        <!-- Card 6 -->
        <div class="bg-white p-8 rounded-2xl shadow-soft-lg hover:shadow-soft-xl transition-all group">
          <div
            class="w-14 h-14 bg-safety-orange/10 rounded-xl flex items-center justify-center mb-5 group-hover:bg-safety-orange transition-all"
          >
            <svg
              class="w-7 h-7 text-safety-orange group-hover:text-white transition-all"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
              ></path>
            </svg>
          </div>
          <h4 class="text-xl font-black mb-4 text-charcoal-900 uppercase tracking-tight">Family Business Values</h4>
          <p class="text-charcoal-700 leading-relaxed">
            We maintain the personalized touch and integrity of a family-run business while offering the stability and
            opportunities of an industry leader.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- SECTION 3: OPEN POSITIONS -->
  <section class="bg-charcoal-900 p-10">
    <div class="container mx-auto max-w-7xl">
      <div class="text-center mb-12">
        <div
          class="inline-block bg-safety-orange text-white px-4 py-2 rounded-lg text-xs font-black mb-4 uppercase tracking-wider"
        >
          Open Positions
        </div>
        <h2 class="text-4xl md:text-5xl font-black mb-6 text-white">Current Opportunities</h2>
        <p class="text-xl text-warm-gray-200 leading-relaxed max-w-3xl mx-auto">
          We're currently seeking talented individuals for the following positions. Don't see the perfect fit? Submit a
          general application—we're always interested in meeting exceptional people who could strengthen our team.
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-5xl mx-auto">
        {
          activeJobs.map((job) => (
            <div class="bg-charcoal-800 p-8 rounded-2xl border border-white/10 hover:border-safety-orange/50 transition-all shadow-soft-lg">
              <h4 class="text-2xl font-black text-white mb-3 uppercase tracking-tight">{job.title}</h4>
              <div class="flex items-start gap-2 text-warm-gray-300">
                <svg
                  class="w-5 h-5 text-safety-orange mt-0.5 flex-shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                  />
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                  />
                </svg>
                <span class="font-bold">{job.locations}</span>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </section>

  <!-- SECTION 4: APPLICATION FORM -->
  <section class="bg-warm-white py-10 px-4 sm:px-6 md:px-10">
    <div class="container mx-auto max-w-5xl">
      <div class="text-center mb-12">
        <div
          class="inline-block bg-safety-orange/10 text-safety-orange px-4 py-2 rounded-lg text-xs font-black mb-4 uppercase tracking-wider"
        >
          Apply Now
        </div>
        <h2 class="text-4xl md:text-5xl font-black mb-6 text-charcoal-900">Submit Your Application</h2>
        <p class="text-lg text-charcoal-700 leading-relaxed max-w-2xl mx-auto">
          Complete the application below to be considered for current and future opportunities at MTN MUD. All
          applications are reviewed by our leadership team, and we'll reach out if your experience matches our needs.
        </p>
      </div>

      <form
        id="careersForm"
        class="bg-charcoal-900 p-10 md:p-12 rounded-2xl shadow-soft-lg border border-white/10 space-y-8"
      >
        {/* Personal Information */}
        <div>
          <h3 class="text-2xl font-black mb-6 text-white uppercase tracking-tight">Personal Information</h3>

          <div class="space-y-4">
            <div>
              <label for="fullName" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider">
                Full Name <span class="text-safety-orange">*</span>
              </label>
              <input
                type="text"
                id="fullName"
                name="fullName"
                required
                placeholder="Enter your full name"
                class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white placeholder-warm-gray-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
              />
            </div>

            <div>
              <label for="email" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider">
                Email Address <span class="text-safety-orange">*</span>
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                placeholder="your.email@example.com"
                class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white placeholder-warm-gray-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
              />
            </div>

            <div>
              <label for="phone" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider">
                Phone Number <span class="text-safety-orange">*</span>
              </label>
              <input
                type="tel"
                id="phone"
                name="phone"
                required
                placeholder="(555) 123-4567"
                class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white placeholder-warm-gray-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
              />
            </div>

            <div>
              <label for="address" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider"
                >Street Address</label
              >
              <input
                type="text"
                id="address"
                name="address"
                placeholder="123 Main Street"
                class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white placeholder-warm-gray-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
              />
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="city" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider">City</label>
                <input
                  type="text"
                  id="city"
                  name="city"
                  placeholder="City"
                  class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white placeholder-warm-gray-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
                />
              </div>
              <div>
                <label for="state" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider">State</label
                >
                <input
                  type="text"
                  id="state"
                  name="state"
                  placeholder="State"
                  class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white placeholder-warm-gray-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
                />
              </div>
            </div>

            <div>
              <label for="zip" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider">ZIP Code</label>
              <input
                type="text"
                id="zip"
                name="zip"
                placeholder="12345"
                class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white placeholder-warm-gray-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
              />
            </div>
          </div>
        </div>

        {/* Position Information */}
        <div>
          <h3 class="text-2xl font-black mb-6 text-white uppercase tracking-tight">Position Information</h3>

          <div class="space-y-4">
            <div>
              <label for="position" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider">
                Position Applying For <span class="text-safety-orange">*</span>
              </label>
              <select
                id="position"
                name="position"
                required
                class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
              >
                <option value="">Select a position...</option>
                {activeJobs.map((job) => <option value={job.id}>{job.title}</option>)}
                <option value="general-application">General Application / Other</option>
              </select>
            </div>

            <div>
              <label for="location" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider">
                Preferred Location <span class="text-safety-orange">*</span>
              </label>
              <select
                id="location"
                name="location"
                required
                class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
              >
                <option value="">Select a location...</option>
                <option value="gillette">Gillette WY</option>
                <option value="cheyenne">Cheyenne WY</option>
                <option value="boulder">Boulder WY</option>
                <option value="williston">Williston ND</option>
                <option value="open">Open to any location</option>
              </select>
            </div>

            <div>
              <label for="startDate" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider"
                >Available Start Date</label
              >
              <input
                type="date"
                id="startDate"
                name="startDate"
                class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
              />
            </div>
          </div>
        </div>

        {/* Experience & Qualifications */}
        <div>
          <h3 class="text-2xl font-black mb-6 text-white uppercase tracking-tight">Experience & Qualifications</h3>

          <div class="space-y-4">
            <div>
              <label for="yearsExperience" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider">
                Years of Experience in Drilling Fluids Industry
              </label>
              <input
                type="text"
                id="yearsExperience"
                name="yearsExperience"
                placeholder="e.g., 5 years"
                class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white placeholder-warm-gray-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
              />
            </div>

            <div>
              <label for="previousRoles" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider">
                Previous Job Titles / Roles
              </label>
              <textarea
                id="previousRoles"
                name="previousRoles"
                rows="3"
                placeholder="List your previous positions and responsibilities"
                class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white placeholder-warm-gray-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
              ></textarea>
            </div>

            <div>
              <label for="certifications" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider">
                Relevant Certifications or Training
              </label>
              <textarea
                id="certifications"
                name="certifications"
                rows="3"
                placeholder="List any relevant certifications, licenses, or training"
                class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white placeholder-warm-gray-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
              ></textarea>
            </div>

            <div>
              <label for="education" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider"
                >Education</label
              >
              <select
                id="education"
                name="education"
                class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
              >
                <option value="">Select education level...</option>
                <option value="high-school">High School/GED</option>
                <option value="some-college">Some College</option>
                <option value="associates">Associate's Degree</option>
                <option value="bachelors">Bachelor's Degree</option>
                <option value="masters">Master's Degree or Higher</option>
                <option value="trade-school">Trade School</option>
              </select>
            </div>

            <div>
              <label for="resume" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider">
                Resume/CV Upload <span class="text-warm-gray-400 italic text-xs font-normal"
                  >(file upload coming soon - email resume to applications@mtnmud.com)</span
                >
              </label>
              <input
                type="file"
                id="resume"
                name="resume"
                accept=".pdf,.doc,.docx"
                disabled
                class="block w-full text-sm text-warm-gray-500 border-2 border-warm-gray-700 rounded-xl cursor-not-allowed bg-charcoal-900 opacity-50
                       file:mr-4 file:py-4 file:px-6 file:border-0 file:bg-warm-gray-700 file:text-warm-gray-400 file:font-bold file:text-sm file:uppercase file:tracking-wider file:cursor-not-allowed file:rounded-l-lg"
              />
              <p class="text-sm text-warm-gray-400 mt-2">
                Resume upload will be available soon. For now, please email your resume to
                <a href="mailto:applications@mtnmud.com" class="text-safety-orange hover:underline"
                  >applications@mtnmud.com</a
                >
                after submitting this form.
              </p>
            </div>

            <div>
              <label for="coverLetter" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider">
                Cover Letter / Why MTN MUD? <span class="text-warm-gray-400 italic text-xs font-normal"
                  >(optional but recommended)</span
                >
              </label>
              <textarea
                id="coverLetter"
                name="coverLetter"
                rows="6"
                placeholder="Tell us why you're interested in joining the MTN MUD team"
                class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white placeholder-warm-gray-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
              ></textarea>
            </div>

            <div>
              <label for="comments" class="block text-white font-bold mb-2 text-sm uppercase tracking-wider"
                >Additional Comments</label
              >
              <textarea
                id="comments"
                name="comments"
                rows="4"
                placeholder="Any additional information you'd like to share"
                class="w-full px-4 py-3 border-2 border-warm-gray-600 bg-charcoal-800 text-white placeholder-warm-gray-400 rounded-xl focus:outline-none focus:ring-2 focus:ring-safety-orange focus:border-safety-orange transition-all"
              ></textarea>
            </div>
          </div>
        </div>

        {/* Certification Checkbox */}
        <div class="flex items-start p-6 bg-charcoal-800 rounded-xl border-2 border-warm-gray-600">
          <input
            type="checkbox"
            id="certify"
            name="certify"
            required
            class="mt-1 mr-4 h-5 w-5 text-safety-orange focus:ring-safety-orange border-warm-gray-400 rounded"
          />
          <label for="certify" class="text-warm-gray-200 leading-relaxed">
            I certify that the information provided is true and complete to the best of my knowledge. <span
              class="text-safety-orange font-bold">*</span
            >
          </label>
        </div>

        {/* Form Messages */}
        <div id="careersFormMessage" class="hidden"></div>

        {/* Submit Button */}
        <div>
          <button
            type="submit"
            id="careersFormSubmit"
            class="w-full bg-safety-orange hover:bg-safety-orange/90 text-white font-bold py-4 px-8 rounded-[10px] uppercase tracking-wider transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span id="careersButtonText">Submit Application</span>
            <i id="careersButtonIcon" class="ri-arrow-right-up-line"></i>
          </button>
        </div>

        {/* Equal Opportunity Note */}
        <div class="text-sm text-warm-gray-200 text-center pt-6 border-t-2 border-warm-gray-600">
          <p>
            <strong class="text-white">MTN MUD is an Equal Opportunity Employer.</strong> We celebrate diversity and are
            committed to creating an inclusive environment for all employees.
          </p>
        </div>
      </form>
    </div>
  </section>
</Layout>

<style>
  /* Override Construz template's fixed height on form inputs */
  select,
  .single-select,
  .form-control,
  .form-select,
  textarea,
  input {
    height: auto !important;
  }

  /* Ensure file inputs display properly */
  input[type='file'] {
    padding: 0 !important;
  }

  /* Force labels to be white */
  form label {
    color: white !important;
  }

  /* Force all form inputs to have white text */
  form input,
  form textarea,
  form select {
    color: white !important;
  }

  /* Force specific input types to have white text */
  form input[type='text'],
  form input[type='email'],
  form input[type='tel'],
  form input[type='date'] {
    color: white !important;
  }

  /* Fix select option colors */
  form select option {
    background-color: #2d2d2d;
    color: white;
  }

  /* Date input calendar icon color fix */
  form input[type='date']::-webkit-calendar-picker-indicator {
    filter: invert(1);
  }

  /* Add padding to select dropdowns for arrow spacing */
  form select {
    padding-right: 3rem !important;
    background-position: right 1rem center !important;
    appearance: none !important;
    -webkit-appearance: none !important;
    -moz-appearance: none !important;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23ffffff' d='M10.293 3.293L6 7.586 1.707 3.293A1 1 0 00.293 4.707l5 5a1 1 0 001.414 0l5-5a1 1 0 10-1.414-1.414z'/%3E%3C/svg%3E") !important;
    background-repeat: no-repeat !important;
    background-size: 12px !important;
  }
</style>

<script is:inline>
  function initCareersForm() {
    const form = document.getElementById('careersForm');
    const submitButton = document.getElementById('careersFormSubmit');
    const buttonText = document.getElementById('careersButtonText');
    const buttonIcon = document.getElementById('careersButtonIcon');
    const messageDiv = document.getElementById('careersFormMessage');

    if (!form || !submitButton || !buttonText || !buttonIcon || !messageDiv) {
      console.log('Careers form elements not found');
      return;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      e.stopPropagation();

      // Disable button and show loading state
      submitButton.disabled = true;
      buttonText.textContent = 'Submitting...';
      buttonIcon.className = 'ri-loader-4-line animate-spin';
      messageDiv.className = 'hidden';

      // Get form data
      const formData = new FormData(form);
      const data = {
        fullName: formData.get('fullName'),
        email: formData.get('email'),
        phone: formData.get('phone'),
        address: formData.get('address'),
        city: formData.get('city'),
        state: formData.get('state'),
        zip: formData.get('zip'),
        position: formData.get('position'),
        location: formData.get('location'),
        startDate: formData.get('startDate'),
        yearsExperience: formData.get('yearsExperience'),
        previousRoles: formData.get('previousRoles'),
        certifications: formData.get('certifications'),
        education: formData.get('education'),
        coverLetter: formData.get('coverLetter'),
        comments: formData.get('comments'),
      };

      try {
        const response = await fetch('/api/application', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        const result = await response.json();

        if (response.ok && result.success) {
          // Success
          messageDiv.className =
            'p-4 rounded-xl bg-green-500/10 border-2 border-green-500 text-green-500 text-center font-bold';
          messageDiv.textContent =
            result.message || "Thank you for your application! We've received your submission and will review it carefully. We'll be in touch soon.";
          form.reset();
          // Scroll to message
          messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
          throw new Error(result.error || 'Failed to submit application');
        }
      } catch (err) {
        // Error
        messageDiv.className =
          'p-4 rounded-xl bg-red-500/10 border-2 border-red-500 text-red-500 text-center font-bold';
        messageDiv.textContent =
          'Sorry, there was an error submitting your application. Please try again or email us directly.';
      } finally {
        // Re-enable button
        submitButton.disabled = false;
        buttonText.textContent = 'Submit Application';
        buttonIcon.className = 'ri-arrow-right-up-line';
      }
    });
  }

  // Initialize on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCareersForm);
  } else {
    initCareersForm();
  }

  // Re-initialize on Astro page transitions
  document.addEventListener('astro:page-load', initCareersForm);
</script>
